<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commute Compute Web Flasher</title>
  <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #eee; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 40px 20px; }
    .container { max-width: 600px; width: 100%; }
    h1 { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { color: #888; margin-bottom: 40px; }
    .card { background: #16213e; border-radius: 16px; padding: 30px; margin-bottom: 20px; }
    .card h2 { font-size: 1.3rem; margin-bottom: 15px; color: #667eea; }
    .card p { color: #aaa; line-height: 1.6; margin-bottom: 15px; }
    .steps { list-style: none; counter-reset: step; }
    .steps li { counter-increment: step; padding: 12px 0; padding-left: 45px; position: relative; border-bottom: 1px solid #1a1a2e; }
    .steps li:last-child { border-bottom: none; }
    .steps li::before { content: counter(step); position: absolute; left: 0; top: 12px; width: 30px; height: 30px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
    .flash-section { text-align: center; padding: 40px; }
    esp-web-install-button { --inst-button-color: #667eea; }
    esp-web-install-button::part(button) { font-size: 1.2rem; padding: 15px 40px; border-radius: 30px; cursor: pointer; }
    .warning { background: #2d1f1f; border: 1px solid #5a3333; border-radius: 8px; padding: 15px; margin-top: 20px; }
    .warning h3 { color: #ff6b6b; margin-bottom: 10px; }
    .devices { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px; }
    .device { background: #1a1a2e; padding: 15px; border-radius: 8px; flex: 1; min-width: 150px; text-align: center; }
    .device.supported { border: 2px solid #4ade80; }
    .device.coming { border: 2px solid #fbbf24; opacity: 0.7; }
    .device span { display: block; font-size: 2rem; margin-bottom: 10px; }
    a { color: #667eea; }
    footer { margin-top: 40px; color: #666; font-size: 0.9rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÉ Commute Compute</h1>
    <p class="subtitle">Smart Transit Display - Web Flasher</p>
    
    <div class="card">
      <h2>Supported Devices</h2>
      <div class="devices">
        <div class="device supported">
          <span>üìü</span>
          <strong>TRMNL OG</strong>
          <small>800x480 e-ink</small>
        </div>
        <div class="device supported">
          <span>üì±</span>
          <strong>ESP32-C3</strong>
          <small>DevKit</small>
        </div>
        <div class="device coming">
          <span>üìñ</span>
          <strong>Kindle</strong>
          <small>Coming Soon</small>
        </div>
      </div>
    </div>
    
    <div class="card flash-section">
      <h2>Flash Your Device</h2>
      <p>Connect your device via USB and click the button below.</p>
      <p style="margin-bottom: 25px;"><small>Works in Chrome, Edge, and Opera browsers.</small></p>
      
      <esp-web-install-button manifest="/flasher/manifest.json">
        <button slot="activate">üîå Install Commute Compute Firmware</button>
        <span slot="unsupported">Your browser doesn't support Web Serial. Try Chrome or Edge.</span>
        <span slot="not-allowed">Serial access not allowed. Check browser permissions.</span>
      </esp-web-install-button>
      
      <div class="warning">
        <h3>‚ö†Ô∏è Before Flashing</h3>
        <p>Make sure your device is in bootloader mode. For TRMNL, hold the BOOT button while connecting USB.</p>
      </div>
    </div>
    
    <div class="card">
      <h2>After Flashing</h2>
      <ol class="steps">
        <li>Device shows welcome screen with setup instructions</li>
        <li>Connect to WiFi network: <strong>CommuteCompute-Setup</strong></li>
        <li>Open browser: <strong>192.168.4.1</strong></li>
        <li>Enter your WiFi credentials and server URL</li>
        <li>Visit your server's <strong>/setup</strong> page to configure stops</li>
      </ol>
    </div>
    
    <div class="card">
      <h2>Need a Server?</h2>
      <p>Deploy your own Commute Compute server in one click:</p>
      <p style="margin-top: 15px;">
        <a href="https://vercel.com/new/clone?repository-url=https://github.com/angusbergman17-cpu/CommuteCompute" target="_blank">
          <img src="https://vercel.com/button" alt="Deploy with Vercel" />
        </a>
      </p>
    </div>
    
    <footer style="margin-top: 30px; padding: 20px; text-align: center; font-size: 13px; color: #94a3b8; border-top: 1px solid rgba(255,255,255,0.1);">
      <div style="margin-bottom: 12px;">
        <a href="https://opendata.transport.vic.gov.au" target="_blank" rel="noopener" style="color: #94a3b8;">Transport Victoria OpenData</a> (CC BY 4.0) ‚Ä¢
        <a href="/attribution.html" style="color: #94a3b8;">All Sources</a>
      </div>
      <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 12px;">
        <a href="https://buymeacoffee.com/angusbergman" target="_blank" rel="noopener" 
           style="padding: 6px 12px; background: #FFDD00; color: #000; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 12px;">
          ‚òï Buy me a coffee
        </a>
        <a href="https://github.com/sponsors/angusbergman17-cpu" target="_blank" rel="noopener"
           style="padding: 6px 12px; background: #db61a2; color: #fff; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 12px;">
          üíñ Sponsor
        </a>
        <a href="https://github.com/angusbergman17-cpu/CommuteCompute/issues/new" target="_blank" rel="noopener"
           style="padding: 6px 12px; background: #6366f1; color: #fff; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 12px;">
          üìù Feedback
        </a>
      </div>
      <div style="font-size: 11px;">
        ¬© 2025-2026 <a href="https://github.com/angusbergman17-cpu" target="_blank" rel="noopener" style="color: #94a3b8;">Angus Bergman</a> ‚Ä¢
        <a href="/LICENCE" target="_blank" rel="noopener" style="color: #94a3b8;">AGPL v3</a>
      </div>
    </footer>
  </div>
</body>
</html>
